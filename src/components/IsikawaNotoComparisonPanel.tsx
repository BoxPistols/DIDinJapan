/**
 * Ishikawa Noto Comparison Panel Component
 * çŸ³å·çœŒ2020å¹´ã¨èƒ½ç™»2024å¹´ã®DIDãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒè¡¨ç¤ºã™ã‚‹UI
 * 
 * ãƒ‰ãƒ­ãƒ¼ãƒ³é£›è¡Œç”³è«‹ç”¨ã«ã€åœ°éœ‡å‰å¾Œã®åœ°å½¢å¤‰åŒ–ã‚’è¦–è¦šçš„ã«æ¯”è¼ƒã§ãã¾ã™ã€‚
 * é€æ˜åº¦ã‚’å€‹åˆ¥ã«èª¿æ•´ã—ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é‡ã­åˆã‚ã›ã¦ç¢ºèªå¯èƒ½ã€‚
 */

import { useState, useRef } from 'react'\nimport { showToast } from '../utils/toast'\n\nexport interface IsikawaNotoComparisonPanelProps {\n  onLayerToggle: (layerId: string, visible: boolean) => void\n  onOpacityChange: (layerId: string, opacity: number) => void\n  visibleLayers: Set<string>\n  opacityLayers: Map<string, number>\n  darkMode?: boolean\n}\n\nconst LAYER_CONFIG = {\n  ishikawa2020: {\n    id: 'did-17-ishikawa-2020',\n    name: 'çŸ³å·çœŒ (2020å¹´)',\n    year: 2020,\n    color: '#4444FF',\n    description: '2020å¹´å›½å‹¢èª¿æŸ»DIDï¼ˆåœ°éœ‡å‰åŸºæº–ãƒ‡ãƒ¼ã‚¿ï¼‰',\n    helpText: 'é’è‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹2020å¹´ã®äººå£é›†ä¸­åœ°åŒº'\n  },\n  noto2024: {\n    id: 'terrain-2024-noto',\n    name: 'èƒ½ç™»åŠå³¶ (2024å¹´)',\n    year: 2024,\n    color: '#FF4444',\n    description: '2024å¹´èƒ½ç™»åŠå³¶åœ°éœ‡å¾Œã®åœ°å½¢ãƒ‡ãƒ¼ã‚¿',\n    helpText: 'èµ¤è‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹2024å¹´ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆéš†èµ·åœ°åŸŸã‚’åæ˜ ï¼‰'\n  }\n}\n\nexport function IsikawaNotoComparisonPanel({\n  onLayerToggle,\n  onOpacityChange,\n  visibleLayers,\n  opacityLayers,\n  darkMode = false\n}: IsikawaNotoComparisonPanelProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [hoveredLayer, setHoveredLayer] = useState<string | null>(null)\n\n  const isLayerVisible = (layerId: string) => visibleLayers.has(layerId)\n  const getOpacity = (layerId: string) => opacityLayers.get(layerId) ?? 0.5\n\n  const handleToggle = (layerId: string) => {\n    onLayerToggle(layerId, !isLayerVisible(layerId))\n  }\n\n  const handleOpacityChange = (layerId: string, opacity: number) => {\n    onOpacityChange(layerId, opacity)\n  }\n\n  if (!isOpen) {\n    return (\n      <button\n        onClick={() => setIsOpen(true)}\n        title=\"çŸ³å·çœŒ2020å¹´ vs èƒ½ç™»2024å¹´ã®åœ°å½¢æ¯”è¼ƒ\"\n        style={{\n          position: 'fixed',\n          bottom: 80,\n          right: 20,\n          padding: '10px 16px',\n          backgroundColor: '#e17055',\n          color: '#fff',\n          border: 'none',\n          borderRadius: '8px',\n          cursor: 'pointer',\n          fontSize: '12px',\n          boxShadow: '0 2px 8px rgba(0,0,0,0.2)',\n          zIndex: 999,\n          fontWeight: 'bold',\n          whiteSpace: 'nowrap'\n        }}\n      >\n        ğŸ“Š åœ°å½¢æ¯”è¼ƒ\n      </button>\n    )\n  }\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        bottom: 20,\n        right: 20,\n        width: '380px',\n        maxHeight: '70vh',\n        backgroundColor: darkMode ? '#2a2a2a' : '#fff',\n        color: darkMode ? '#fff' : '#333',\n        borderRadius: '12px',\n        boxShadow: '0 4px 24px rgba(0,0,0,0.15)',\n        zIndex: 999,\n        overflow: 'hidden',\n        display: 'flex',\n        flexDirection: 'column',\n        border: `2px solid ${darkMode ? '#444' : '#e0e0e0'}`\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          padding: '14px 16px',\n          background: 'linear-gradient(135deg, #e17055 0%, #d63031 100%)',\n          color: '#fff',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          flexShrink: 0\n        }}\n      >\n        <div>\n          <h3 style={{ margin: '0 0 2px', fontSize: '14px', fontWeight: 'bold' }}>\n            ğŸ“Š åœ°å½¢å¤‰åŒ–æ¯”è¼ƒ\n          </h3>\n          <p style={{ margin: 0, fontSize: '11px', opacity: 0.9 }}>\n            2024å¹´èƒ½ç™»åœ°éœ‡ã«ã‚ˆã‚‹åœ°å½¢å¤‰åŒ–\n          </p>\n        </div>\n        <button\n          onClick={() => setIsOpen(false)}\n          style={{\n            background: 'none',\n            border: 'none',\n            color: '#fff',\n            cursor: 'pointer',\n            fontSize: '18px',\n            padding: '0',\n            width: '24px',\n            height: '24px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }}\n          title=\"é–‰ã˜ã‚‹\"\n        >\n          âœ•\n        </button>\n      </div>\n\n      {/* Content */}\n      <div\n        style={{\n          flex: 1,\n          overflowY: 'auto',\n          padding: '14px',\n          display: 'flex',\n          flexDirection: 'column',\n          gap: '12px'\n        }}\n      >\n        {/* Info Box */}\n        <div\n          style={{\n            padding: '10px 12px',\n            backgroundColor: darkMode ? 'rgba(225, 112, 85, 0.1)' : '#fff3e0',\n            border: `1px solid ${darkMode ? '#444' : '#ffe0b2'}`,\n            borderRadius: '6px',\n            fontSize: '12px',\n            color: darkMode ? '#ffb74d' : '#e65100',\n            lineHeight: '1.4'\n          }}\n        >\n          <strong>ğŸ’¡ ä½¿ç”¨æ–¹æ³•:</strong> ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§é€æ˜åº¦ã‚’èª¿æ•´ã—ã€2ã¤ã®å¹´åº¦ãƒ‡ãƒ¼ã‚¿ã‚’é‡ã­åˆã‚ã›ã¦åœ°å½¢å¤‰åŒ–ã‚’æ¯”è¼ƒã—ã¦ãã ã•ã„ã€‚\n        </div>\n\n        {/* Layer Controls */}\n        {[LAYER_CONFIG.ishikawa2020, LAYER_CONFIG.noto2024].map((layer) => (\n          <div\n            key={layer.id}\n            onMouseEnter={() => setHoveredLayer(layer.id)}\n            onMouseLeave={() => setHoveredLayer(null)}\n            style={{\n              padding: '12px',\n              backgroundColor: darkMode ? '#333' : '#f5f5f5',\n              border: `2px solid ${hoveredLayer === layer.id ? layer.color : 'transparent'}`,\n              borderRadius: '8px',\n              transition: 'all 0.2s ease',\n              cursor: 'pointer'\n            }}\n          >\n            {/* Layer Header */}\n            <div\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: '10px',\n                marginBottom: '10px'\n              }}\n            >\n              {/* Visibility Checkbox */}\n              <input\n                type=\"checkbox\"\n                checked={isLayerVisible(layer.id)}\n                onChange={() => handleToggle(layer.id)}\n                style={{\n                  width: '18px',\n                  height: '18px',\n                  cursor: 'pointer',\n                  accentColor: layer.color\n                }}\n              />\n\n              {/* Color Indicator */}\n              <div\n                style={{\n                  width: '16px',\n                  height: '16px',\n                  backgroundColor: layer.color,\n                  borderRadius: '3px',\n                  border: `2px solid ${darkMode ? '#555' : '#ddd'}`\n                }}\n              />\n\n              {/* Layer Info */}\n              <div style={{ flex: 1 }}>\n                <div style={{ fontSize: '13px', fontWeight: '600', marginBottom: '2px' }}>\n                  {layer.name}\n                </div>\n                <div\n                  style={{\n                    fontSize: '11px',\n                    color: darkMode ? '#aaa' : '#888',\n                    display: hoveredLayer === layer.id ? 'block' : 'none'\n                  }}\n                >\n                  {hoveredLayer === layer.id\n                    ? layer.helpText\n                    : layer.description}\n                </div>\n              </div>\n\n              {/* Year Badge */}\n              <div\n                style={{\n                  padding: '2px 8px',\n                  backgroundColor: layer.color,\n                  color: '#fff',\n                  borderRadius: '4px',\n                  fontSize: '11px',\n                  fontWeight: 'bold',\n                  minWidth: '50px',\n                  textAlign: 'center'\n                }}\n              >\n                {layer.year}\n              </div>\n            </div>\n\n            {/* Opacity Slider */}\n            {isLayerVisible(layer.id) && (\n              <div\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '8px'\n                }}\n              >\n                <label style={{ fontSize: '11px', color: darkMode ? '#999' : '#666', minWidth: '60px' }}>\n                  é€æ˜åº¦:\n                </label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"100\"\n                  value={Math.round(getOpacity(layer.id) * 100)}\n                  onChange={(e) => handleOpacityChange(layer.id, parseInt(e.target.value) / 100)}\n                  style={{\n                    flex: 1,\n                    height: '6px',\n                    borderRadius: '3px',\n                    outline: 'none',\n                    accentColor: layer.color,\n                    cursor: 'pointer'\n                  }}\n                />\n                <span style={{ fontSize: '11px', minWidth: '30px', textAlign: 'right' }}>\n                  {Math.round(getOpacity(layer.id) * 100)}%\n                </span>\n              </div>\n            )}\n          </div>\n        ))}\n\n        {/* Comparison Tips */}\n        <div\n          style={{\n            padding: '10px 12px',\n            backgroundColor: darkMode ? 'rgba(100, 100, 255, 0.1)' : '#e3f2fd',\n            border: `1px solid ${darkMode ? '#444' : '#bbdefb'}`,\n            borderRadius: '6px',\n            fontSize: '11px',\n            color: darkMode ? '#64b5f6' : '#1565c0'\n          }}\n        >\n          <div style={{ fontWeight: 'bold', marginBottom: '4px' }}>ğŸ“ ãƒ‰ãƒ­ãƒ¼ãƒ³é£›è¡Œç”³è«‹ã§ã®æ´»ç”¨:</div>\n          <ul style={{ margin: '4px 0', paddingLeft: '16px' }}>\n            <li>é€æ˜åº¦50%ã§ä¸¡ãƒ‡ãƒ¼ã‚¿ã‚’é‡ã­åˆã‚ã›</li>\n            <li>éš†èµ·ã‚¨ãƒªã‚¢ã®æ­£ç¢ºãªåº§æ¨™ã‚’ç¢ºèª</li>\n            <li>æµ·å²¸ç·šã®å¤‰åŒ–ã‚’ç¢ºèª</li>\n            <li>DIDå¤‰æ›´ã‚¨ãƒªã‚¢ã‚’è­˜åˆ¥</li>\n          </ul>\n        </div>\n\n        {/* Status */}\n        <div\n          style={{\n            padding: '8px 12px',\n            backgroundColor: darkMode ? '#444' : '#fafafa',\n            borderRadius: '4px',\n            fontSize: '10px',\n            color: darkMode ? '#aaa' : '#666',\n            textAlign: 'center'\n          }}\n        >\n          {isLayerVisible(LAYER_CONFIG.ishikawa2020.id) &&\n          isLayerVisible(LAYER_CONFIG.noto2024.id)\n            ? 'âœ… ä¸¡ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™'\n            : isLayerVisible(LAYER_CONFIG.ishikawa2020.id) ||\n                isLayerVisible(LAYER_CONFIG.noto2024.id)\n              ? 'âš ï¸ ç‰‡æ–¹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿è¡¨ç¤ºä¸­'\n              : 'â¸ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒéè¡¨ç¤ºã§ã™'}\n        </div>\n      </div>\n\n      {/* Help Text */}\n      <div\n        style={{\n          padding: '8px 14px',\n          backgroundColor: darkMode ? '#1a1a1a' : '#f8f8f8',\n          borderTop: `1px solid ${darkMode ? '#444' : '#e0e0e0'}`,\n          fontSize: '10px',\n          color: darkMode ? '#888' : '#888',\n          lineHeight: '1.3',\n          flexShrink: 0\n        }}\n      >\n        ğŸ’¾ æœ¬ãƒ‘ãƒãƒ«ã®è¨­å®šã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ä¿æŒã•ã‚Œã¾ã™ã€‚\n        ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã™ã‚‹ã¨åˆæœŸçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚\n      </div>\n    </div>\n  )\n}\n\nexport default IsikawaNotoComparisonPanel\n